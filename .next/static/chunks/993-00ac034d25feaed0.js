"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[993],{38206:function(e,a,r){r.d(a,{U:function(){return t},l:function(){return n}});var l=r(79639);let t=e=>l.Z.get("/api/applications/".concat(e)).then(e=>e.data),n=e=>l.Z.put("/api/applications/".concat(e.id),e.data).then(e=>e.data)},53071:function(e,a,r){r.d(a,{W:function(){return s},s:function(){return n}});var l=r(37220),t=r(79639);let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;return t.Z.get("/api/applications?".concat(l.Z.stringify({offset:e,status:a,organizationId:r})))},s=e=>t.Z.post("/api/applications",e)},79639:function(e,a,r){var l=r(29222);let t=l.Z.create({headers:{"Content-Type":"text/plain;charset=UTF-8"}});a.Z=t},33314:function(e,a,r){r.d(a,{A:function(){return t}});var l=r(79639);let t=()=>l.Z.get("/api/organization").then(e=>e.data)},90282:function(e,a,r){r.d(a,{Y:function(){return n},Z:function(){return t}});var l=r(79639);let t=()=>l.Z.get("/api/organizations"),n=e=>l.Z.post("/api/organizations",e)},26710:function(e,a,r){r.d(a,{Z:function(){return v}});var l=r(57437),t=r(53071),n=r(38206),s=r(79639);let d=e=>s.Z.get("/api/files",{params:{applicationId:e}}).then(e=>e.data),i=e=>s.Z.post("/api/files",e.data,{params:{applicationId:e.applicationId}}).then(e=>e.data);var o=r(33314),c=r(90282),u=r(64273),x=e=>(0,l.jsx)("svg",{className:e.className,color:"gray",style:{fontSize:e.fontSize,width:"1em",height:"1em",verticalAlign:"middle",fill:"currentColor",overflow:"hidden"},viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{d:"M642 82H162v860h700V302L642 82z m20 76.6L785.4 282H662V158.6zM822 902H202V122h420v200h200v580z"})}),m=r(12025),f=r(64874),p=r(70165),h=r(55764),g=r(61396),y=r.n(g),b=r(2265),v=e=>{var a;let{data:r,newApplicationId:s,onCancel:g,onUpdated:v}=e,{data:j,isSuccess:k}=(0,f.a)(["user",(0,u.n)()],{staleTime:1/0,retry:0,queryFn:o.A}),N=(null==j?void 0:j.data.role)==="admin",{data:w}=(0,f.a)({queryKey:["users",(0,u.n)()],staleTime:1/0,enabled:N,retry:0,queryFn:()=>(0,c.Z)()}),{data:T}=(0,f.a)({queryKey:["files",null==r?void 0:r.id],queryFn:()=>d(null==r?void 0:r.id),staleTime:1/0,retry:0,enabled:!!(null==r?void 0:r.id)}),q=(0,p.NL)(),z=(0,b.useRef)(null),D=(0,b.useRef)(null),Z=(0,h.D)(n.l),S=(0,h.D)(i),V=(0,h.D)(t.W),A=!N&&!!r&&(null==r?void 0:r.status)!=="в обработке",C=async e=>{if(e.preventDefault(),z.current){var a,l;let e=new FormData(z.current),t=null==r?void 0:r.id;if(N&&r||(null==r?void 0:r.status)==="в обработке"){let{data:a}=await Z.mutateAsync({id:r.id,data:e});v&&v(a)}else if(!r){let{data:{data:a}}=await V.mutateAsync(e);t=a.id}if(null===(l=D.current)||void 0===l?void 0:null===(a=l.files)||void 0===a?void 0:a.length){let e=new FormData;for(let a=0;a<D.current.files.length;a++){let l=D.current.files[a];e.append("files",l,l.name);let{data:n}=await S.mutateAsync({applicationId:t,data:e});T&&q.setQueryData(["files",null==r?void 0:r.id],e=>e?{...e,data:[...e.data,...n]}:void 0)}D.current.value=""}r||g(),q.refetchQueries({queryKey:["application",(0,u.n)(),1]})}},F=(0,l.jsxs)("div",{children:[(0,l.jsx)(m.Typography,{children:"Прикрепленные файлы:"}),(0,l.jsx)("div",{children:null==T?void 0:T.data.map((e,a)=>(0,l.jsxs)(y(),{className:"font-medium text-blue-600 dark:text-blue-500 hover:underline mr-3",href:"/api/files/".concat(e.name),children:["Файл ",a+1]},e.id))})]});return(0,l.jsxs)("form",{ref:z,onSubmit:C,children:[(0,l.jsxs)("div",{className:"flex mb-5",children:[(0,l.jsxs)("div",{className:"flex mr-20",children:[(0,l.jsx)(m.Typography,{className:"mr-10",children:"№"})," ",(0,l.jsxs)("span",{className:"border-b border-black",children:["AM-",((null==r?void 0:r.id)||s||0).toString().padStart(6,"0")]})]}),(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)(m.Typography,{className:"mr-10",children:"Дата создания"})," ",(0,l.jsx)("input",{readOnly:!0,defaultValue:(null==r?void 0:r.createdAt)?new Date(null==r?void 0:r.createdAt).toLocaleDateString():new Date().toLocaleDateString()})]})]}),(0,l.jsxs)("div",{className:"flex mb-5 gap-10",children:[(0,l.jsx)("div",{className:"flex flex-1 justify-between",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(m.Typography,{className:"w-56",children:"Статус"})," ",N?(0,l.jsxs)("select",{defaultValue:null==r?void 0:r.status,name:"status",className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",children:[(0,l.jsx)("option",{value:"в обработке",selected:!0,children:"В обработке"}),(0,l.jsx)("option",{value:"в работе",children:"В работе"}),(0,l.jsx)("option",{value:"выполнена",children:"Выполнена"})]}):(0,l.jsx)("input",{readOnly:!0,name:"status",defaultValue:(null==r?void 0:r.status)||"в обработке"})]})}),N&&w&&(0,l.jsxs)("div",{className:"flex flex-1 items-center",children:[(0,l.jsx)(m.Typography,{className:"w-56",children:"Организация"}),(0,l.jsx)("select",{required:!0,defaultValue:null===(a=w.data.data.find(e=>e.name===(null==r?void 0:r.organization.name)))||void 0===a?void 0:a.id,name:"organizationUserId",className:"mt-1 border h-full border-gray-300 text-sm rounded-lg block w-full dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",children:w.data.data.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(m.Typography,{className:"mr-2",children:"Срочная задача"}),(0,l.jsx)("input",{type:"checkbox",name:"isUrgent",defaultChecked:null==r?void 0:r.isUrgent})]}),N&&(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(m.Typography,{className:"mr-2",children:"Добавить в архив"}),(0,l.jsx)("input",{type:"checkbox",name:"isArchived",defaultChecked:null==r?void 0:r.isArchived})]})]}),(0,l.jsxs)("div",{className:"flex mb-5",children:[(0,l.jsx)(m.Typography,{className:"w-56",children:"Наименование*"})," ",(0,l.jsx)("input",{type:"text",disabled:A,defaultValue:null==r?void 0:r.title,className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"title",required:!0})]}),(0,l.jsxs)("div",{className:"flex mb-5",children:[(0,l.jsx)(m.Typography,{className:"w-56",children:"Описание*"})," ",(0,l.jsx)("textarea",{name:"description",defaultValue:null==r?void 0:r.description,required:!0,disabled:A,rows:4,className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none"})]}),(0,l.jsxs)("div",{className:"flex mb-5",children:[(0,l.jsx)(m.Typography,{className:"w-56",children:"Имя*"})," ",(0,l.jsx)("input",{type:"text",disabled:A,className:"flex-0.5 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"name",defaultValue:null==r?void 0:r.name,required:!0})]}),(0,l.jsxs)("div",{className:"flex mb-5",children:[(0,l.jsx)(m.Typography,{className:"w-56",children:"Телефон*"})," ",(0,l.jsx)("input",{type:"text",disabled:A,className:"flex-0.5 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"phone",defaultValue:null==r?void 0:r.phone,required:!0})]}),(0,l.jsxs)("div",{className:"flex mb-5",children:[(0,l.jsx)(m.Typography,{className:"w-56",children:"Email"})," ",(0,l.jsx)("input",{type:"text",disabled:A,className:"flex-0.5 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"email",defaultValue:null==r?void 0:r.email})]}),N&&(0,l.jsxs)("div",{className:"flex mb-5",children:[(0,l.jsx)(m.Typography,{className:"w-56",children:"Срок выполнения*"})," ",(0,l.jsx)("input",{type:"text",placeholder:"11.11.2011",disabled:A,className:"flex-0.25 border-b border-black text-sm block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:outline-none",name:"deadline",defaultValue:(null==r?void 0:r.deadline)?new Date(null==r?void 0:r.deadline).toLocaleDateString():"",required:!0})]}),(0,l.jsx)("div",{className:"w-3/4",children:(0,l.jsx)("textarea",{name:"comment",placeholder:"Комментарий",defaultValue:null==r?void 0:r.comment,disabled:A,rows:4,className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none"})}),(0,l.jsxs)("div",{className:"flex justify-end items-center mt-4",children:[(null==T?void 0:T.data)&&(null==r?void 0:r.status)!=="в обработке"?F:(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)(m.Typography,{className:"mr-4",children:["Прикрепить файлы(до ",10-((null==T?void 0:T.data.length)||0),")"]})," ",(0,l.jsxs)("div",{onClick:()=>{var e;null===(e=D.current)||void 0===e||e.click()},className:"inline-block p-1 rounded-full border-gray-500 border",children:[(0,l.jsx)(x,{className:"text-gray-500",fontSize:25}),(0,l.jsx)("input",{ref:D,className:"hidden",accept:".jpg, .png, .jpeg, .rar, .zip, .docx, .pdf",type:"file",max:10-((null==T?void 0:T.data.length)||0),multiple:!0})]})]}),(null==T?void 0:T.data)&&F]})}),(0,l.jsx)("div",{className:"flex-1"}),(0,l.jsx)(m.Button,{variant:"text",color:"gray",className:"mr-1",onClick:g,children:r?"Вернуться":"Отмена"}),r?N||"в обработке"===r.status?(0,l.jsx)(m.Button,{variant:"outlined",className:"border-accent text-accent",type:"submit",children:"Обновить задачу"}):null:(0,l.jsx)(m.Button,{variant:"outlined",className:"border-accent text-accent",type:"submit",children:"Отправить задачу"})]})]})}},52278:function(e,a,r){r.d(a,{Z:function(){return h}});var l=r(57437),t=r(79639);let n=()=>t.Z.post("/api/logout");var s=r(33314),d=r(90282),i=r(64273),o=r(12025),c=r(64874),u=r(55764),x=r(16691),m=r.n(x),f=r(24033),p=r(2265),h=e=>{let{children:a}=e,r=(0,f.useRouter)(),[t,x]=(0,p.useState)(!1),{data:h,error:g,isError:y,isLoading:b}=(0,c.a)({queryKey:["user",(0,i.n)()],staleTime:1/0,retry:0,queryFn:s.A}),{mutateAsync:v}=(0,u.D)({mutationFn:()=>n()}),j=(0,u.D)(d.Y);(0,p.useEffect)(()=>{(null==g?void 0:g.response.status)===401&&k()},[g]);let k=async()=>{try{await v()}catch(e){}r.push("/login")},N=async e=>{e.preventDefault();let a=new FormData(e.target);await j.mutateAsync(a),alert("Организация добавлена"),x(!1)};return b||y?(0,l.jsx)("div",{className:"container flex items-center h-screen mx-auto py-4",children:(0,l.jsx)(o.Spinner,{className:"h-12 w-12 mx-auto"})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("header",{className:"fixed w-full bg-white py-4 z-10",children:(0,l.jsxs)("div",{className:"container flex justify-between mx-auto",children:[(0,l.jsx)(m(),{onClick:()=>{r.push("/")},className:"cursor-pointer",src:"/logo.png",width:300,height:29,alt:"Logo"}),(0,l.jsxs)("span",{className:"flex items-center",children:["Добро пожаловать",(0,l.jsx)("span",{className:"text-accent font-bold pl-2",children:null==h?void 0:h.data.email}),(0,l.jsxs)(o.Menu,{placement:"bottom-end",children:[(0,l.jsx)(o.MenuHandler,{children:(0,l.jsx)(o.Button,{size:"sm",className:"ml-1 p-2 border-accent text-accent",variant:"outlined",children:"меню"})}),(0,l.jsxs)(o.MenuList,{children:["admin"===h.data.role&&(0,l.jsx)(o.MenuItem,{onClick:()=>{x(!0)},children:"Добавить организацию"}),(0,l.jsx)(o.MenuItem,{onClick:k,children:"Выход"})]})]})," "]})]})}),(0,l.jsx)("div",{className:"container mx-auto pt-20 pb-10",children:a}),(0,l.jsx)("footer",{className:"p-10 border-t-accent border-t"}),t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"justify-center items-center flex overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none",children:(0,l.jsx)("div",{className:"relative w-auto my-6 mx-auto max-w-3xl",children:(0,l.jsxs)("form",{onSubmit:N,className:"border-0 rounded-lg shadow-lg relative flex flex-col w-full bg-white outline-none focus:outline-none",children:[(0,l.jsx)("div",{className:"flex items-start justify-between p-5 border-b border-solid border-slate-200 rounded-t",children:(0,l.jsx)("h3",{className:"text-3xl font-semibold",children:"Добавление организации"})}),(0,l.jsxs)("div",{className:"relative p-6 flex-auto",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(o.Typography,{children:"Email"}),(0,l.jsx)("input",{type:"text",className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"email",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(o.Typography,{children:"Пароль"}),(0,l.jsx)("input",{type:"text",className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"password",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(o.Typography,{children:"Название организации"}),(0,l.jsx)("input",{type:"text",className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"name",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(o.Typography,{children:"УНП"}),(0,l.jsx)("input",{type:"text",className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"uid",required:!0})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-end p-6 border-t border-solid border-slate-200 rounded-b",children:[(0,l.jsx)(o.Button,{onClick:()=>{x(!1)},size:"sm",className:"ml-1 p-2 border-accent text-accent",variant:"outlined",children:"Отмена"}),(0,l.jsx)(o.Button,{type:"submit",size:"sm",className:"ml-1 p-2 border-accent text-accent",variant:"outlined",children:"Добавить"})]})]})})}),(0,l.jsx)("div",{className:"opacity-25 fixed inset-0 z-40 bg-black"})]})]})}},64273:function(e,a,r){r.d(a,{S:function(){return l},n:function(){return t}});let l=e=>localStorage.setItem("loginTime",e),t=()=>localStorage.getItem("loginTime")}}]);