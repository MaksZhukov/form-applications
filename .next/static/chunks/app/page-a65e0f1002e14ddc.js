(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{90254:function(e,a,n){Promise.resolve().then(n.bind(n,39816))},53071:function(e,a,n){"use strict";n.d(a,{W:function(){return l},s:function(){return s}});var t=n(37220),r=n(79639);let s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return r.Z.get("/api/applications?".concat(t.Z.stringify({offset:e,status:a,organizationId:n})))},l=e=>r.Z.post("/api/applications",e)},79639:function(e,a,n){"use strict";var t=n(29222);let r=t.Z.create({headers:{"Content-Type":"text/plain;charset=UTF-8"}});a.Z=r},33314:function(e,a,n){"use strict";n.d(a,{A:function(){return r}});var t=n(79639);let r=()=>t.Z.get("/api/organization").then(e=>e.data)},90282:function(e,a,n){"use strict";n.d(a,{Y:function(){return s},Z:function(){return r}});var t=n(79639);let r=()=>t.Z.get("/api/organizations"),s=e=>t.Z.post("/api/organizations",e)},52278:function(e,a,n){"use strict";n.d(a,{Z:function(){return p}});var t=n(57437),r=n(79639);let s=()=>r.Z.post("/api/logout");var l=n(33314),i=n(90282),o=n(64273),c=n(12025),d=n(64874),u=n(55764),m=n(16691),x=n.n(m),h=n(24033),g=n(2265),p=e=>{let{children:a}=e,n=(0,h.useRouter)(),[r,m]=(0,g.useState)(!1),{data:p,error:f,isError:y,isLoading:j}=(0,d.a)({queryKey:["user",(0,o.n)()],staleTime:1/0,retry:0,queryFn:l.A}),{mutateAsync:b}=(0,u.D)({mutationFn:()=>s()}),v=(0,u.D)(i.Y);(0,g.useEffect)(()=>{(null==f?void 0:f.response.status)===401&&N()},[f]);let N=async()=>{try{await b()}catch(e){}n.push("/login")},k=async e=>{e.preventDefault();let a=new FormData(e.target);await v.mutateAsync(a),alert("Организация добавлена"),m(!1)};return j||y?(0,t.jsx)("div",{className:"container flex items-center h-screen mx-auto py-4",children:(0,t.jsx)(c.Spinner,{className:"h-12 w-12 mx-auto"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("header",{className:"fixed w-full bg-white py-4 z-10",children:(0,t.jsxs)("div",{className:"container flex justify-between mx-auto",children:[(0,t.jsx)(x(),{onClick:()=>{n.push("/")},className:"cursor-pointer",src:"/logo.png",width:300,height:29,alt:"Logo"}),(0,t.jsxs)("span",{className:"flex items-center",children:["Добро пожаловать",(0,t.jsx)("span",{className:"text-accent font-bold pl-2",children:null==p?void 0:p.data.email}),(0,t.jsxs)(c.Menu,{placement:"bottom-end",children:[(0,t.jsx)(c.MenuHandler,{children:(0,t.jsx)(c.Button,{size:"sm",className:"ml-1 p-2 border-accent text-accent",variant:"outlined",children:"меню"})}),(0,t.jsxs)(c.MenuList,{children:["admin"===p.data.role&&(0,t.jsx)(c.MenuItem,{onClick:()=>{m(!0)},children:"Добавить организацию"}),(0,t.jsx)(c.MenuItem,{onClick:N,children:"Выход"})]})]})," "]})]})}),(0,t.jsx)("div",{className:"container mx-auto pt-20 pb-10",children:a}),(0,t.jsx)("footer",{className:"p-10 border-t-accent border-t"}),r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"justify-center items-center flex overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none",children:(0,t.jsx)("div",{className:"relative w-auto my-6 mx-auto max-w-3xl",children:(0,t.jsxs)("form",{onSubmit:k,className:"border-0 rounded-lg shadow-lg relative flex flex-col w-full bg-white outline-none focus:outline-none",children:[(0,t.jsx)("div",{className:"flex items-start justify-between p-5 border-b border-solid border-slate-200 rounded-t",children:(0,t.jsx)("h3",{className:"text-3xl font-semibold",children:"Добавление организации"})}),(0,t.jsxs)("div",{className:"relative p-6 flex-auto",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Typography,{children:"Email"}),(0,t.jsx)("input",{type:"text",className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"email",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Typography,{children:"Пароль"}),(0,t.jsx)("input",{type:"text",className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"password",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Typography,{children:"Название организации"}),(0,t.jsx)("input",{type:"text",className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"name",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Typography,{children:"УНП"}),(0,t.jsx)("input",{type:"text",className:"flex-1 border border-gray-300 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",name:"uid",required:!0})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end p-6 border-t border-solid border-slate-200 rounded-b",children:[(0,t.jsx)(c.Button,{onClick:()=>{m(!1)},size:"sm",className:"ml-1 p-2 border-accent text-accent",variant:"outlined",children:"Отмена"}),(0,t.jsx)(c.Button,{type:"submit",size:"sm",className:"ml-1 p-2 border-accent text-accent",variant:"outlined",children:"Добавить"})]})]})})}),(0,t.jsx)("div",{className:"opacity-25 fixed inset-0 z-40 bg-black"})]})]})}},64273:function(e,a,n){"use strict";n.d(a,{S:function(){return t},n:function(){return r}});let t=e=>localStorage.setItem("loginTime",e),r=()=>localStorage.getItem("loginTime")},39816:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return h}});var t=n(57437),r=n(12025),s=n(64874),l=n(24033),i=n(2265),o=n(53071),c=n(33314),d=n(90282),u=n(52278),m=n(64273),x=e=>{let{data:a,total:n=0,organizations:i=[],page:o,selectedOrganizationId:d,selectedStatus:u,onChangePage:x,onChangeOrganization:h,onChangeStatus:g}=e,{data:p}=(0,s.a)(["user",(0,m.n)()],{staleTime:1/0,retry:0,queryFn:c.A}),f=(null==p?void 0:p.data.role)==="admin",y=(0,l.useRouter)(),j=e=>()=>{y.push("/".concat(e.id))},b=Math.ceil(n/25),v=[{name:"№"},{name:"Дата создания"},{name:"Наименование"},...f?[{name:"Организация",filter:(0,t.jsxs)("select",{value:d,onChange:h,className:"mt-1 border border-gray-300 text-sm rounded-lg block w-full dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",children:[(0,t.jsx)("option",{value:"none",children:"Не выбрано"}),i.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})},{name:"Дедлайн"}]:[],{name:"Статус",filter:f&&(0,t.jsxs)("select",{value:u,onChange:g,className:"mt-1 border border-gray-300 text-sm rounded-lg block w-full dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-1 focus:ring-accent focus:outline-none",children:[(0,t.jsx)("option",{value:"none",children:"Не выбрано"}),(0,t.jsx)("option",{value:"В обработке",children:"В обработке"}),(0,t.jsx)("option",{value:"В работе",children:"В работе"}),(0,t.jsx)("option",{value:"Выполнена",children:"Выполнена"})]})},{name:"Срочность"},{name:""}];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("table",{className:"w-full min-w-max table-auto text-left",children:[(0,t.jsx)("thead",{children:(0,t.jsx)("tr",{children:v.map(e=>(0,t.jsx)("th",{className:"border-b border-gray-100 p-3",children:(0,t.jsxs)(r.Typography,{variant:"small",className:"font-bold leading-none opacity-90",children:[e.name,e.filter]})},e.name))})}),(0,t.jsx)("tbody",{children:a.map((e,n)=>{let s=n===a.length-1,l=s?"p-3 align-baseline":"p-3 border-b border-accent align-baseline";return(0,t.jsxs)("tr",{children:[(0,t.jsxs)("td",{className:l,children:["AM-",e.id.toString().padStart(6,"0")]}),(0,t.jsx)("td",{className:l,children:(0,t.jsx)(r.Typography,{variant:"small",className:"font-normal",children:e.createdAt})}),(0,t.jsxs)("td",{className:l+" max-w-xs",children:[(0,t.jsx)(r.Typography,{variant:"medium",className:"font-normal",children:e.title}),(0,t.jsxs)(r.Typography,{className:"font-normal text-xs",children:["Описание. ",e.description]})]}),f&&(0,t.jsxs)("td",{className:l+" max-w-xs",children:[(0,t.jsx)(r.Typography,{variant:"medium",className:"font-normal",children:e.organization.name}),(0,t.jsxs)(r.Typography,{className:"font-normal text-xs",children:["УНП: ",e.organization.uid]})]}),f&&(0,t.jsx)("td",{className:l,children:(0,t.jsx)(r.Typography,{variant:"small",className:"font-normal",children:e.deadline})}),(0,t.jsx)("td",{className:l,children:(0,t.jsx)(r.Typography,{variant:"small",className:"font-normal",children:e.status})}),(0,t.jsx)("td",{className:l,children:e.isUrgent?(0,t.jsx)("div",{className:"w-6 h-6 bg-accent rounded-full"}):""}),(0,t.jsx)("td",{className:l,children:(0,t.jsx)(r.Button,{variant:"outlined",className:"border-accent text-accent",onClick:j(e),children:"Подробнее"})})]},e.id)})})]}),(0,t.jsx)("div",{className:"w-full flex",children:b>1&&(0,t.jsx)(r.ButtonGroup,{variant:"outlined",className:"mx-auto",children:Array(b).fill(null).map((e,a)=>(0,t.jsx)(r.IconButton,{className:o===a+1?"bg-blue-100 text-blue-gray-900":"",onClick:x(a+1),children:a+1},a+1))})})]})};function h(){var e;let a=(0,l.useRouter)(),[n,h]=(0,i.useState)(1),[g,p]=(0,i.useState)("none"),[f,y]=(0,i.useState)("none"),{data:j,isLoading:b}=(0,s.a)({queryKey:["application",(0,m.n)(),n,g,f],staleTime:1/0,retry:0,keepPreviousData:!0,queryFn:()=>(0,o.s)((n-1)*25,"none"===g?void 0:g,"none"===f?void 0:f)}),{data:v}=(0,s.a)({queryKey:["user",(0,m.n)()],staleTime:1/0,retry:0,queryFn:c.A}),N=(null==v?void 0:v.data.role)==="admin",{data:k}=(0,s.a)({queryKey:["users",(0,m.n)()],staleTime:1/0,enabled:N,retry:0,queryFn:d.Z});return(0,t.jsx)(u.Z,{children:b?(0,t.jsx)("div",{children:(0,t.jsx)(r.Spinner,{className:"h-12 w-12 mx-auto"})}):j&&(0,t.jsxs)(t.Fragment,{children:[" ",(0,t.jsx)(r.Button,{className:"mb-4 bg-accent",onClick:()=>{a.push("/new")},children:"Новая задача"}),(0,t.jsx)(x,{organizations:null==k?void 0:k.data.data,selectedOrganizationId:f,selectedStatus:g,onChangeStatus:e=>{p(e.target.value)},onChangeOrganization:e=>{y(e.target.value)},data:j.data.data,total:null===(e=j.data.meta)||void 0===e?void 0:e.total,onChangePage:e=>()=>{h(e),window.scroll(0,0)},page:n})]})})}}},function(e){e.O(0,[384,410,107,791,971,596,744],function(){return e(e.s=90254)}),_N_E=e.O()}]);